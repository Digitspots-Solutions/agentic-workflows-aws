graph TD
    User((Student/User))
    
    subgraph "Public Internet"
        WA[WhatsApp Webhook]
        Browser[Web Browser]
    end
    
    subgraph "AWS Cloud (VPC)"
        ALB[Application Load Balancer]
        
        subgraph "Public Subnet / ECS Cluster"
            Dash[Streamlit Dashboard <br/>(ECS Fargate)]
        end
        
        subgraph "Core Agent Service"
            BAC[Bedrock AgentCore <br/>(Serverless Runtime)]
            Mem[(AgentCore Memory <br/>DynamoDB)]
            Model[Bedrock Model <br/>(Claude 3.5 Haiku)]
            Guard[Bedrock Guardrails <br/>(Content Safety)]
        end
        
        subgraph "Tools Layer (Lambda)"
            Orch[Orchestrator Agent]
            T1[Course Tool]
            T2[Finance Tool]
            T3[Calendar Tool]
            T4[Hostel Tool]
        end
        
        subgraph "Private Data Layer"
            RDS[(Amazon RDS <br/>PostgreSQL)]
            SM[Secrets Manager <br/>(Credentials)]
        end
    end
    
    %% Flows
    User -->|HTTPS| ALB
    User -->|Message| WA
    Browser -->|HTTPS| ALB
    ALB -->|Forward| Dash
    Dash -->|InvokeAgent API| BAC
    WA -->|InvokeAgent API| BAC
    
    BAC <-->|Context/State| Mem
    BAC <-->|Inference| Model
    BAC <-->|Check| Guard
    
    BAC -->|Execute| Orch
    Orch -->|Route| T1
    Orch -->|Route| T2
    Orch -->|Route| T3
    Orch -->|Route| T4
    
    T1 -->|SQL Query| RDS
    T2 -->|SQL Query| RDS
    T3 -->|SQL Query| RDS
    T4 -->|SQL Query| RDS
    
    T1 -.->|Get Creds| SM
    T2 -.->|Get Creds| SM
    T3 -.->|Get Creds| SM
    T4 -.->|Get Creds| SM
